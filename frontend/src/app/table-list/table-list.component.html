<div class="main-content">
  <div class="container-fluid">
    <!-- Header Section with Search and Filters -->
    <div class="row mb-4">
      <div class="col-md-12">
        <div class="card">
          <!-- Header Section with Purple Background -->
          <div class="card-header card-header-primary">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h4 class="card-title mb-0">
                  <i class="material-icons mr-2">list_alt</i>
                  Service Request List
                </h4>
                <p class="card-category mb-0">
                  Manage and track all service requests for your company
                </p>
              </div>
              <div class="d-flex align-items-center">
                <button
                  class="btn btn-primary btn-round"
                  routerLink="/create-service-request"
                >
                  <i class="material-icons">add</i>
                  Create New Request
                </button>
              </div>
            </div>
          </div>

          <!-- Search and Filters Section with White Background -->
          <div class="card-body">
            <div class="row align-items-end">
              <div class="col-md-4">
                <div class="form-group">
                  <label class="bmd-label-floating">
                    <i class="material-icons mr-1">search</i>
                    Search Requests
                  </label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">
                        <i class="material-icons">search</i>
                      </span>
                    </div>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Search by title, description, or creator..."
                      [(ngModel)]="searchTerm"
                      (input)="onSearchChange()"
                    />
                    <div class="input-group-append" *ngIf="searchTerm">
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="searchTerm = ''; onSearchChange()"
                      >
                        <i class="material-icons">clear</i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group">
                  <label class="bmd-label-floating">
                    <i class="material-icons mr-1">flag</i>
                    Status
                  </label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">
                        <i class="material-icons">filter_list</i>
                      </span>
                    </div>
                    <select
                      class="form-control custom-select"
                      [(ngModel)]="statusFilter"
                      (change)="onFilterChange()"
                    >
                      <option value="">All Statuses</option>
                      <option value="open">Open</option>
                      <option value="in_progress">In Progress</option>
                      <option value="completed">Completed</option>
                      <option value="cancelled">Cancelled</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group">
                  <label class="bmd-label-floating">
                    <i class="material-icons mr-1">priority_high</i>
                    Urgency
                  </label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">
                        <i class="material-icons">schedule</i>
                      </span>
                    </div>
                    <select
                      class="form-control custom-select"
                      [(ngModel)]="urgencyFilter"
                      (change)="onFilterChange()"
                    >
                      <option value="">All Urgencies</option>
                      <option value="low">Low</option>
                      <option value="medium">Medium</option>
                      <option value="high">High</option>
                      <option value="critical">Critical</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group">
                  <button
                    class="btn btn-outline-danger btn-round btn-block filter-btn"
                    (click)="clearFilters()"
                  >
                    <i class="material-icons mr-1">clear_all</i>
                    Clear All
                  </button>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group">
                  <button
                    class="btn btn-outline-primary btn-round btn-block filter-btn"
                    (click)="refreshData()"
                  >
                    <i class="material-icons mr-1">refresh</i>
                    Refresh
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading service requests...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="row">
      <div class="col-md-12">
        <div
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <i class="material-icons mr-2">error</i>
          {{ error }}
          <button type="button" class="close" (click)="retryLoading()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Service Requests Table -->
    <div *ngIf="!loading && !error" class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-info">
            <div class="d-flex justify-content-between align-items-center">
              <h4 class="card-title mb-0">
                <i class="material-icons mr-2">table_chart</i>
                Service Requests
              </h4>
              <div class="d-flex align-items-center">
                <span class="badge badge-info mr-2"
                  >{{ filteredRequests.length }} requests</span
                >
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="text-primary">
                  <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Urgency</th>
                    <th>Created By</th>
                    <th>Created Date</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let request of filteredRequests"
                    class="request-row"
                  >
                    <td>
                      <span class="badge badge-secondary"
                        >#{{ request.id }}</span
                      >
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="product-icon mr-2">
                          <i class="material-icons">description</i>
                        </div>
                        <strong>{{ request.title }}</strong>
                      </div>
                    </td>
                    <td>
                      <div
                        class="text-truncate"
                        style="max-width: 200px"
                        [title]="request.description"
                      >
                        {{ request.description }}
                      </div>
                    </td>
                    <td>
                      <span [class]="getStatusClass(request.status)">
                        <i class="status-dot"></i>
                        {{ request.status | titlecase }}
                      </span>
                    </td>
                    <td>
                      <span [class]="getUrgencyClass(request.urgency)">
                        <i class="urgency-dot"></i>
                        {{ request.urgency | titlecase }}
                      </span>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="avatar avatar-sm mr-2">
                          <i class="material-icons">account_circle</i>
                        </div>
                        <span
                          >{{ request.createdBy?.firstName }}
                          {{ request.createdBy?.lastName }}</span
                        >
                      </div>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <i class="material-icons mr-1 text-muted">event</i>
                        {{ formatDate(request.createdAt) }}
                      </div>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <i class="material-icons mr-1 text-muted">update</i>
                        {{ formatDate(request.updatedAt) }}
                      </div>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <button
                          class="btn btn-sm btn-link text-muted"
                          [title]="'View details'"
                        >
                          <i class="material-icons">location_on</i>
                        </button>
                        <button
                          class="btn btn-sm btn-link text-muted"
                          [title]="'More options'"
                        >
                          <i class="material-icons">more_vert</i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="filteredRequests.length === 0">
                    <td colspan="9" class="text-center py-5">
                      <div class="empty-state">
                        <i
                          class="material-icons text-muted"
                          style="font-size: 4rem"
                          >inbox</i
                        >
                        <h5 class="text-muted mt-3">
                          No service requests found
                        </h5>
                        <p class="text-muted">
                          No requests match your current filters.
                        </p>
                        <button
                          class="btn btn-primary btn-round"
                          (click)="clearFilters()"
                        >
                          <i class="material-icons">clear</i>
                          Clear Filters
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
